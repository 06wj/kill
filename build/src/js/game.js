KISSY.add("kill/game",function(t,i,e,a,n,r,h,s,o,l){var g=Hilo.Stage,d=Hilo.Ticker,c=(Hilo.Container,Hilo.Bitmap),m=Hilo.View,p=Hilo.Tween,u=window._game={_isInit:!1,init:function(t){this.gameContainer=t,this._bindEvent(),n.init(),i.load(),this.top=51,this.left=20,this.bottom=552,this.right=982},_bindEvent:function(){var t=this;e.on("gameLoadComplete",function(){t._initGame(a.state),Hilo.WebAudio.isSupported=!1;var i=Hilo.WebSound.getAudio({src:__killPath+"audio/Start.mp3",loop:!0});i.play()}),e.on("playerGameOver",function(i){var e=t.playerArr.indexOf(i.player);e>-1&&(t.playerArr.splice(e,1),t.playerArr.length<=0&&t._showGameEnd("gameover"))})},_initGame:function(t){var i=this;if(t=t||0,!i._isInit){this._isInit=!0,this.stage=new g({container:this.gameContainer,width:a.game.width,height:a.game.height});var e=this.ticker=new d(a.fps);e.addTick(this.stage),e.addTick(p),e.start(),this._initBg(),this.bangArr=[],this.playerArr=[],this.monsterArr=[],this.stateMask=new m({x:0,y:0,width:1e3,height:600,background:"#000"})}var n=this.stage,o=this.bangArr,c=this.playerArr,u=this.monsterArr,f=l.getState(t);return f?(f.bangs.forEach(function(t){var i=new h(t);n.addChild(i),o.push(i)}),f.monsters.forEach(function(t){var i=new s(t);n.addChild(i),u.push(i)}),f.players.forEach(function(t){var i=new r(t);n.addChild(i),c.push(i)}),this.hengRects=[this.bangArr[0],this.bangArr[2],this.leftWall,this.rightWall],this.shuRects=[this.bangArr[1],this.bangArr[3],this.topWall,this.bottomWall],void 0):(i._showGameEnd("win"),void 0)},reset:function(){for(;this.bangArr.length;){var t=this.bangArr.pop();t.destroy&&t.destroy(),t.removeFromParent()}for(;this.monsterArr.length;){var t=this.monsterArr.pop();t.destroy&&t.destroy(),t.removeFromParent()}for(;this.playerArr.length;){var t=this.playerArr.pop();t.destroy&&t.destroy(),t.removeFromParent()}},_showGameEnd:function(t){var i=this;this.endBg=this.endBg||document.getElementById("startBg"),this.endBg.style.display="block",this.endBg.style.background="url(../src/img/"+t+"Bg.jpg)",this.endBg.onclick=function(){i.endBg.onclick=null,i.endBg.style.display="none",i.reset(),i._initGame("gameover"===t?l.index:0)}},checkCollision:function(){for(var t=this,i=this.hengRects,e=this.shuRects,a=0;a<i.length;a++)for(var n=a+1;n<i.length;n++)for(var r=0;r<e.length;r++)for(var h=r+1;h<e.length;h++)if((2!=a||3!=n||2!=r||3!=h)&&i[a].hitTestObject(e[r])&&e[r].hitTestObject(i[n])&&i[n].hitTestObject(e[h])&&e[h].hitTestObject(i[a])){t._getMonster(i[a],i[n],e[r],e[h])}},_getMonster:function(t,i,e,a){var n=this,r=Math.min(e.x,a.x),h=Math.max(e.x+e.width,a.x+a.width),s=Math.min(t.y,i.y),o=Math.max(t.y+t.height,i.y+i.height);this.monsterArr.forEach(function(t,i){!t.isDie&&t.x>=r&&t.x+t.width<=h&&t.y>=s&&t.y+t.height<=o&&(t.die&&t.die(),n.monsterArr.splice(i,1),n.monsterArr.length<=0&&n._nextState())})},_nextState:function(){var t=this;console.log("nextState",l.index+1),this.playerArr.forEach(function(t){t.onUpdate=null,t.play("win")}),setTimeout(function(){t.stateMask.alpha=0,t.stage.addChild(t.stateMask),p.to(t.stateMask,{alpha:1},{duration:500,onComplete:function(){t.reset(),p.to(t.stateMask,{alpha:0},{duration:800,onComplete:function(){t._initGame(l.index+1)}})}})},2e3)},_initBg:function(){{var t=this;new c({image:i.get("roadTop"),y:600,pivotY:i.get("roadTop").height}).addTo(this.stage)}this.stage.onUpdate=function(){t.checkCollision()};var e=this.bg=new o;this.stage.addChild(e),this.leftWall=new m({x:0,y:0,width:1e3,height:this.top+10}),this.rightWall=new m({x:0,y:this.bottom-10,width:1e3,height:800-this.bottom+10}),this.topWall=new m({x:0,y:0,width:this.left+10,height:800}),this.bottomWall=new m({x:this.right-10,y:0,width:1e3-this.right+10,height:800}),this.stage.addChild(this.leftWall,this.rightWall,this.topWall,this.bottomWall),this.qiangs=[this.leftWall,this.rightWall,this.topWall,this.bottomWall],a.showHit&&(this.leftWall.background=this.rightWall.background=this.topWall.background=this.bottomWall.background="rgba(255, 0, 0, .3)")}};return u},{requires:["kill/resource","kill/mediator","kill/config","kill/input","kill/player","kill/bang","kill/monster","kill/background","kill/states"]});